@using Microsoft.JSInterop
@implements IAsyncDisposable

<div class="html-viewer-container" style="height: 100%; width: 100%; overflow: auto;">
    <iframe @ref="_iframeRef"
            sandbox="allow-same-origin"
            style="width: 100%; height: 100%; border: none; background: white;"
            title="HTML Response Preview">
    </iframe>
</div>

@code {
    [Parameter]
    public string? HtmlContent { get; set; }

    [Parameter]
    public string? BaseUrl { get; set; }

    [Inject]
    private IJSRuntime JS { get; set; } = default!;

    private ElementReference _iframeRef;
    private IJSObjectReference? _module;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _module = await JS.InvokeAsync<IJSObjectReference>("import", "./js/htmlViewer.js");
        }

        if (_module != null && !string.IsNullOrEmpty(HtmlContent))
        {
            await _module.InvokeVoidAsync("setIframeContent", _iframeRef, HtmlContent, BaseUrl ?? "");
        }
    }

    protected override async Task OnParametersSetAsync()
    {
        if (_module != null && !string.IsNullOrEmpty(HtmlContent))
        {
            await _module.InvokeVoidAsync("setIframeContent", _iframeRef, HtmlContent, BaseUrl ?? "");
        }
    }

    public async ValueTask DisposeAsync()
    {
        if (_module != null)
        {
            await _module.DisposeAsync();
        }
    }
}

